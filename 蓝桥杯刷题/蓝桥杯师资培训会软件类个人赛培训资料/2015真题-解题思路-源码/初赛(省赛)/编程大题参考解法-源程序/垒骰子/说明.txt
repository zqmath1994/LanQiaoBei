直接搜索可以得基础分。

令 f_{i, j} 表示用 i 个骰子，最后一层正面朝上的为 j 的方案数。
由于已知每个面相对的面是哪个面，所以原题的限制相当于：i 和 j 不能相邻 等价于 i 和 j 的对面 不能是相邻两个正面朝上的面。例如，1 和 2 不能相邻表示不能存在相邻两个骰子的正面朝上分别为 1 和 5 ，也不能是 2 和 4 。
这样我们可以写出 f 的转移公式： f_{i + 1, j} = sum_{all possible k} f_{i, k} 。利用这个转移可以写出一个 O(n) 的 dp 。

观察这个转移，我们发现可以用一个矩阵来描述 f_i 到 f_j 。要求 f_n ，我们可以使用矩阵乘法。时间复杂度为 O(log n * 6^3)