试题分析：
首先不难发现：修建水渠的肯定是y坐标整点。因此对于20%的数据，暴力枚举哪一个位置修建水渠即可。接下来我们需要观察出，这是一个平面图，因而每个点能到达的居民点一定是连续的一段（因为有南北向水渠所以这一点比较显然）。接下来，如果把N个水塔能到达的居民点区间都求出来，则区间是单调不降的。这同样取决于平面图的性质。
由于没有（双向）重边，所以图肯定是一个拓扑图。要想得到每个水塔能到达哪些居民点，只要把拓扑图构出来，并按拓扑序进行dp（得到每个点能到达的最左最右点即可）。
接下来枚举那条添加的边。这条边肯定是加在某个“关键点”向右的――所谓关键点就是所有居民点、路的端点、水塔。枚举它一共有O(M+N)种情况。这条路必然把原来的一个点向右的距离扩展了一段。接下来，假设这个点能由[l,r]这一段居民点到达（这里易知也是连续的，可以在反图上dp求出），那么就相当于这些区间的右端点都和某个数取max。因为右端点有序，所以很容易维护。其它之前提到的操作都可以用stl解决。
整个算法复杂度为O(NlogN)。用O(N^2)等较劣的算法直接实现可得60分或40分。
